"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const errors_1 = require("../errors");
const json_1 = require("./json");
function formatTargets(args, targets) {
    const { devices, virtualDevices, errors } = targets;
    const virtualOnly = args.includes('--virtual');
    const devicesOnly = args.includes('--device');
    if (virtualOnly && devicesOnly) {
        throw new errors_1.CLIException('Only one of --device or --virtual may be specified', errors_1.ERR_BAD_INPUT);
    }
    if (args.includes('--json')) {
        let result;
        if (virtualOnly) {
            result = { virtualDevices, errors };
        }
        else if (devicesOnly) {
            result = { devices, errors };
        }
        else {
            result = { devices, virtualDevices, errors };
        }
        return json_1.stringify(result);
    }
    let output = '';
    if (errors.length > 0) {
        output += `Errors (!):\n\n${errors.map(e => `  ${errors_1.serializeError(e)}`)}\n`;
    }
    if (!virtualOnly) {
        output += printTargets('Connected Device', devices);
        if (devicesOnly) {
            return output;
        }
        output += '\n';
    }
    output += printTargets('Virtual Device', virtualDevices);
    return output;
}
exports.formatTargets = formatTargets;
function printTargets(name, targets) {
    let output = `${name}s:\n\n`;
    if (targets.length === 0) {
        output += `  No ${name.toLowerCase()}s found\n`;
    }
    else {
        for (const target of targets) {
            output += `  ${(target.format())}\n`;
        }
    }
    return output;
}
