"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const util_1 = require("util");
async function unzip(srcPath, onEntry) {
    const yauzl = await Promise.resolve().then(() => require('yauzl'));
    const open = util_1.promisify(yauzl.open.bind(yauzl));
    return new Promise(async (resolve, reject) => {
        try {
            const zipfile = await open(srcPath, { lazyEntries: true });
            const openReadStream = util_1.promisify(zipfile.openReadStream.bind(zipfile));
            zipfile.once('error', reject);
            // resolve when either one happens
            zipfile.once('close', resolve); // fd of zip closed
            zipfile.once('end', resolve); // last entry read
            zipfile.on('entry', entry => onEntry(entry, zipfile, openReadStream));
            zipfile.readEntry();
        }
        catch (error) {
            reject(error);
        }
    });
}
exports.unzip = unzip;
